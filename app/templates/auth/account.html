{% extends "base.html" %}

{% block title %}Account Settings - RansomRun{% endblock %}
{% block page_title %}Account Settings{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="panel">
            <div class="panel-header">
                <h3 class="panel-title">Account Information</h3>
            </div>
            <div class="panel-body">
                <div class="mb-4">
                    <label class="form-label text-muted">Email</label>
                    <p class="h5">{{ user.email }}</p>
                </div>
                
                <div class="mb-4">
                    <label class="form-label text-muted">Role</label>
                    <p>
                        <span class="badge {% if user.role.value == 'admin' %}badge-danger{% else %}badge-primary{% endif %}">
                            {{ user.role.value|upper }}
                        </span>
                    </p>
                </div>
                
                <div class="mb-4">
                    <label class="form-label text-muted">Account Created</label>
                    <p>{{ user.created_at.strftime('%B %d, %Y at %H:%M UTC') }}</p>
                </div>
                
                {% if user.last_login_at %}
                <div class="mb-4">
                    <label class="form-label text-muted">Last Login</label>
                    <p>{{ user.last_login_at.strftime('%B %d, %Y at %H:%M UTC') }}</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="panel mt-4">
            <div class="panel-header">
                <h3 class="panel-title">Change Password</h3>
            </div>
            <div class="panel-body">
                {% if success %}
                <div class="alert alert-success">
                    <i class="bi bi-check-circle"></i> {{ success }}
                </div>
                {% endif %}
                
                {% if error %}
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> {{ error }}
                </div>
                {% endif %}
                
                <form method="POST" action="/account/change-password" id="changePasswordForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    
                    <div class="mb-3">
                        <label for="current_password" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="current_password" 
                               name="current_password" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="new_password" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="new_password" 
                               name="new_password" required>
                        <small class="text-muted">
                            Must be at least 10 characters with 1 digit and 1 special symbol
                        </small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirm_password" 
                               name="confirm_password" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-key"></i> Change Password
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .alert-success {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: #86efac;
        border-radius: 6px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .alert-danger {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #fca5a5;
        border-radius: 6px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
</style>

<script>
document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (newPassword !== confirmPassword) {
        e.preventDefault();
        alert('New passwords do not match!');
        return false;
    }
    
    // Basic client-side validation
    if (newPassword.length < 10) {
        e.preventDefault();
        alert('Password must be at least 10 characters long');
        return false;
    }
    
    if (!/\d/.test(newPassword)) {
        e.preventDefault();
        alert('Password must contain at least one digit');
        return false;
    }
    
    if (!/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/~`]/.test(newPassword)) {
        e.preventDefault();
        alert('Password must contain at least one special symbol');
        return false;
    }
});
</script>
{% endblock %}
