{% extends "business/base.html" %}

{% block title %}Tenant Management{% endblock %}
{% block page_title %}Customer / Tenant Management{% endblock %}

{% block content %}
<!-- Stats Overview -->
<div class="tenant-stats">
    <div class="tenant-stat-card">
        <div class="stat-icon" style="background: rgba(139, 92, 246, 0.15); color: #a78bfa;">
            <i class="bi bi-building"></i>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ organizations|length }}</div>
            <div class="stat-label">Total Organizations</div>
        </div>
    </div>
    <div class="tenant-stat-card">
        <div class="stat-icon" style="background: rgba(34, 197, 94, 0.15); color: #4ade80;">
            <i class="bi bi-check-circle"></i>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ organizations|selectattr('org.is_active')|list|length }}</div>
            <div class="stat-label">Active</div>
        </div>
    </div>
    <div class="tenant-stat-card">
        <div class="stat-icon" style="background: rgba(251, 191, 36, 0.15); color: #fbbf24;">
            <i class="bi bi-star"></i>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ organizations|selectattr('org.plan.value', 'equalto', 'ENTERPRISE')|list|length }}</div>
            <div class="stat-label">Enterprise</div>
        </div>
    </div>
    <div class="tenant-stat-card">
        <div class="stat-icon" style="background: rgba(59, 130, 246, 0.15); color: #60a5fa;">
            <i class="bi bi-people"></i>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ organizations|sum(attribute='user_count') }}</div>
            <div class="stat-label">Total Users</div>
        </div>
    </div>
</div>

<div class="card org-card">
    <div class="card-header">
        <h3 class="card-title"><i class="bi bi-building me-2"></i>Organizations</h3>
        <button class="btn btn-primary btn-sm" onclick="document.getElementById('new-org-modal').style.display='block'">
            <i class="bi bi-plus"></i> Add Organization
        </button>
    </div>
    <table class="org-table">
        <thead>
            <tr>
                <th>Organization</th>
                <th>Industry</th>
                <th>Plan</th>
                <th>Endpoints</th>
                <th>Users</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in organizations %}
            <tr class="org-row">
                <td>
                    <div class="org-name">
                        <div class="org-avatar">{{ item.org.name[0] }}</div>
                        <div class="org-details">
                            <strong>{{ item.org.name }}</strong>
                            <span class="org-email">{{ item.org.contact_email or 'No contact' }}</span>
                        </div>
                    </div>
                </td>
                <td><span class="industry-tag">{{ item.org.industry or 'N/A' }}</span></td>
                <td>
                    <span class="plan-badge plan-{{ item.org.plan.value|lower }}">
                        {% if item.org.plan.value == 'ENTERPRISE' %}
                        <i class="bi bi-gem"></i>
                        {% elif item.org.plan.value == 'PRO' %}
                        <i class="bi bi-lightning"></i>
                        {% else %}
                        <i class="bi bi-flask"></i>
                        {% endif %}
                        {{ item.org.plan.value }}
                    </span>
                </td>
                <td><span class="count-badge">{{ item.org.max_endpoints or 0 }}</span></td>
                <td><span class="count-badge">{{ item.user_count }}</span></td>
                <td>
                    <span class="status-badge {% if item.org.is_active %}status-active{% else %}status-inactive{% endif %}">
                        <span class="status-dot"></span>
                        {{ 'Active' if item.org.is_active else 'Inactive' }}
                    </span>
                </td>
                <td class="date-cell">{{ item.org.created_at.strftime('%b %d, %Y') }}</td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn" title="View Details"><i class="bi bi-eye"></i></button>
                        <button class="action-btn" title="Edit"><i class="bi bi-pencil"></i></button>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="8" class="empty-state">
                <i class="bi bi-building" style="font-size: 48px; opacity: 0.3;"></i>
                <p>No organizations yet. Create your first one above.</p>
            </td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="new-org-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Organization</h3>
            <button onclick="document.getElementById('new-org-modal').style.display='none'" class="modal-close">&times;</button>
        </div>
        <form action="/business/tenants" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <div class="form-group">
                <label class="form-label">Organization Name</label>
                <input type="text" name="name" class="form-control" required placeholder="Acme Corp">
            </div>
            <div class="form-group">
                <label class="form-label">Industry</label>
                <select name="industry" class="form-control">
                    <option value="">Select industry...</option>
                    <option value="Financial Services">Financial Services</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Technology">Technology</option>
                    <option value="Manufacturing">Manufacturing</option>
                    <option value="Retail">Retail</option>
                    <option value="Government">Government</option>
                    <option value="Education">Education</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Plan</label>
                <select name="plan" class="form-control">
                    <option value="LAB">Lab (Free)</option>
                    <option value="PRO">Pro</option>
                    <option value="ENTERPRISE">Enterprise</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Contact Email</label>
                <input type="email" name="contact_email" class="form-control" placeholder="admin@company.com">
            </div>
            <button type="submit" class="btn-primary w-100">Create Organization</button>
        </form>
    </div>
</div>

<style>
    /* Stats Cards */
    .tenant-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-bottom: 24px;
    }
    .tenant-stat-card {
        background: linear-gradient(135deg, #1a1a1f 0%, #252530 100%);
        border: 1px solid #2a2a35;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .tenant-stat-card .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
    }
    .tenant-stat-card .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #fff;
    }
    .tenant-stat-card .stat-label {
        font-size: 13px;
        color: #888;
    }
    
    /* Organization Table */
    .org-card { overflow: hidden; }
    .org-table {
        width: 100%;
        border-collapse: collapse;
    }
    .org-table thead {
        background: #1a1a1f;
    }
    .org-table th {
        padding: 14px 16px;
        text-align: left;
        font-size: 12px;
        font-weight: 600;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 1px solid #2a2a35;
    }
    .org-table td {
        padding: 16px;
        border-bottom: 1px solid #1f1f25;
        color: #e0e0e0;
    }
    .org-row:hover {
        background: rgba(139, 92, 246, 0.05);
    }
    
    /* Organization Name Cell */
    .org-name {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .org-avatar {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 16px;
        color: #fff;
    }
    .org-details strong {
        display: block;
        color: #fff;
        font-size: 14px;
        margin-bottom: 2px;
    }
    .org-email {
        font-size: 12px;
        color: #666;
    }
    
    /* Industry Tag */
    .industry-tag {
        background: rgba(99, 102, 241, 0.1);
        color: #a5b4fc;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
    }
    
    /* Plan Badges */
    .plan-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }
    .plan-enterprise {
        background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%);
        color: #fbbf24;
        border: 1px solid rgba(251, 191, 36, 0.3);
    }
    .plan-pro {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(124, 58, 237, 0.1) 100%);
        color: #a78bfa;
        border: 1px solid rgba(139, 92, 246, 0.3);
    }
    .plan-lab {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(22, 163, 74, 0.1) 100%);
        color: #4ade80;
        border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    /* Count Badge */
    .count-badge {
        background: #252530;
        color: #e0e0e0;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
    }
    
    /* Status Badge */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
    }
    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    .status-active {
        background: rgba(34, 197, 94, 0.15);
        color: #4ade80;
    }
    .status-active .status-dot {
        background: #4ade80;
        box-shadow: 0 0 8px #4ade80;
    }
    .status-inactive {
        background: rgba(239, 68, 68, 0.15);
        color: #f87171;
    }
    .status-inactive .status-dot {
        background: #f87171;
    }
    
    /* Date Cell */
    .date-cell {
        color: #888;
        font-size: 13px;
    }
    
    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    .action-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: 1px solid #2a2a35;
        background: transparent;
        color: #888;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }
    .action-btn:hover {
        background: #8b5cf6;
        border-color: #8b5cf6;
        color: #fff;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px !important;
        color: #666;
    }
    .empty-state p {
        margin-top: 12px;
    }
    
    /* Modal */
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .modal-content { background: #1a1a1f; border-radius: 16px; padding: 28px; width: 100%; max-width: 500px; border: 1px solid #2a2a35; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .modal-header h3 { margin: 0; font-size: 20px; color: #fff; }
    .modal-close { background: none; border: none; font-size: 28px; color: #666; cursor: pointer; }
    .modal-close:hover { color: #fff; }
    
    @media (max-width: 1200px) {
        .tenant-stats { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
        .tenant-stats { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}
